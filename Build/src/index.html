<!DOCTYPE html>
<html lang="en" data-theme="default">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTMLPlayer</title>
  <!-- <link rel="shortcut icon" type="image/x-icon" href="favicon.png"> -->
  <!-- <link rel="apple-touch-icon" href="/favicon.png"> -->
  <!-- <link rel="manifest" href="manifest.json"> -->
  <link rel="stylesheet" href="./styles.css">
  <script src="https://unpkg.com/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
</head>
<body>
  <header>HTMLPlayer</header>
  <div id="container">
    <!-- Playlist Panel -->
    <div id="playlistPanel">
      <h2>Playlists</h2>
      <ul id="playlistNames"></ul>
      <input type="text" id="newPlaylistName" placeholder="New Playlist Name">
      <button id="addPlaylist">Add Playlist</button>
      <button id="setPlaylistArt">Set Playlist Art</button>
      <input type="file" id="playlistArtInput" accept="image/*">
      <button id="togglePlaylistBulk">Toggle Bulk Delete</button>
      <div id="playlistBulkControls">
        <button id="deleteSelectedPlaylists">Delete Selected</button>
        <button id="deleteAllPlaylists">Delete All</button>
      </div>
    </div>
    <!-- Main Player Area -->
    <div id="mainPlayer">
      <button id="toggleTrackBulk">Toggle Bulk Delete Tracks</button>
      <div id="trackBulkControls">
        <button id="deleteSelectedTracks">Delete Selected</button>
        <button id="deleteAllTracks">Delete All</button>
      </div>
      <div id="trackList">
        <ul id="tracks"></ul>
      </div>
      <!-- Visualizer -->
      <!-- <div id="visualizerContainer" style="width: 100%; height: 128px; background: #000;">
        <div id="visualizer" style="width: 100%; height: 100%;"></div>
      </div> -->
      <div class="visualizer-section">
        <div id="visualizer-container" style="width: 100%; height: 384px; background: #000;"></div>
      </div>

      <!-- Grouped Player Controls -->
      <div id="playerControls">
        <!-- Current Track Art -->
        <div id="currentTrackArt">
          <img id="currentArtImg" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiMzMzMiIC8+PGxpbmUgeDE9IjAiIHkxPSIwIiB4Mj0iMTAwIiB5Mj0iMTAwIiBzdHJva2U9IiNmMWYxZjEiIHN0cm9rZS13aWR0aD0iNSIgLz48bGluZSB4MT0iMTAwIiB5MT0iMCIgeDI9IjAiIHkyPSIxMDAiIHN0cm9rZT0iI2YxZjFmMSIgc3Ryb2tlLXdpZHRoPSI1IiAvPjwvc3ZnPg==" alt="No Art">
        </div>
        <!-- Inner Controls -->
        <div id="innerControls">
          <div id="controls">
            <button id="shuffleBtn" title="Shuffle" class="toggle-btn">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M4,4 L10,4 L14,10 L10,16 L4,16" fill="none" stroke="#fff" stroke-width="2"/>
                <polyline points="14,4 20,4 20,10" fill="none" stroke="#fff" stroke-width="2"/>
                <polyline points="14,16 20,16 20,20" fill="none" stroke="#fff" stroke-width="2"/>
              </svg>
              <svg class="indicator-dot" viewBox="0 0 8 8">
                <circle cx="4" cy="4" r="4" fill="#2196F3"/>
              </svg>
            </button>
            <button id="prevBtn" title="Previous">
              <svg class="icon" viewBox="0 0 24 24">
                <polygon points="15,18 9,12 15,6" />
              </svg>
            </button>
            <button id="playPauseBtn" title="Play/Pause">
              <svg class="icon" id="playIcon" viewBox="0 0 24 24">
                <polygon points="8,5 19,12 8,19" />
              </svg>
              <svg class="icon" id="pauseIcon" viewBox="0 0 24 24" style="display:none;">
                <rect x="6" y="5" width="4" height="14"/>
                <rect x="14" y="5" width="4" height="14"/>
              </svg>
            </button>
            <button id="nextBtn" title="Next">
              <svg class="icon" viewBox="0 0 24 24">
                <polygon points="9,6 15,12 9,18" />
              </svg>
            </button>
            <button id="repeatBtn" title="Repeat" class="toggle-btn">
              <svg class="icon" viewBox="0 0 24 24">
                <path d="M17 1l4 4-4 4M7 23l-4-4 4-4" fill="none" stroke="#fff" stroke-width="2"/>
                <path d="M3 11V9a4 4 0 0 1 4-4h10" fill="none" stroke="#fff" stroke-width="2"/>
                <path d="M21 13v2a4 4 0 0 1-4 4H7" fill="none" stroke="#fff" stroke-width="2"/>
              </svg>
              <svg class="indicator-dot" viewBox="0 0 8 8">
                <circle cx="4" cy="4" r="4" fill="#2196F3"/>
              </svg>
            </button>
          </div>
          <div id="progressContainer">
            <div id="progress"></div>
          </div>
          <div id="timeDisplay">0:00 / 0:00</div>
          <div id="volumeContainer">
            <svg class="icon" viewBox="0 0 24 24">
              <polygon points="5,9 9,9 13,5 13,19 9,15 5,15" />
            </svg>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
          </div>
        </div>
      </div>
      
      <!-- Add Music Button -->
      <button id="uploadBtn">Add Music</button>
      <!-- <button id="install-button" hidden>Install App</button> -->
    </div>
  </div>
  
  <!-- Popups for Adding and Processing -->
  <div id="addingPopup">Adding... 0 entries</div>
  <div id="processingPopup">Processing... 0/0</div>
  
  <!-- Settings Modal -->
  <div id="settingsModal" class="modal hidden fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="modal-content" id="settingsContent">
      <!-- Dynamic settings content will be injected here -->
    </div>
    <button id="closeSettings" style="position: absolute; top: 100px; right: 300px; z-index: 100; color: #000000; border: none; border-radius: 50%; width: 48px; height: 48px; font-size: 1.7rem; box-shadow: 0 2px 8px rgba(0,0,0,0.2); cursor: pointer; display: flex; align-items: center; justify-content: center;" aria-label="Close Settings">üÖá</button>
  </div>

  <!-- PLaylist Name Overlay -->
  <div id="playlistNameModal" class="hidden" style="
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: #222;
    border: 1px solid #666;
    padding: 1rem;
    z-index: 1000;
  ">
    <label for="playlistNameInput" style="display:block; margin-bottom: 0.5rem; color: white;">
      Playlist name:
    </label>
    <input type="text" id="playlistNameInput" style="width: 100%; margin-bottom: 1rem;">
    <button id="savePlaylistNameBtn" style="margin-right: 0.5rem;">Save</button>
    <button id="cancelPlaylistNameBtn">Cancel</button>
  </div>

  <!-- Settings Button -->
  <button id="settingsBtn" style="position: absolute; bottom: 20px; right: 24px; z-index: 100; background: #2196F3; color: #fff; border: none; border-radius: 50%; width: 48px; height: 48px; font-size: 1.7rem; box-shadow: 0 2px 8px rgba(0,0,0,0.2); cursor: pointer; display: flex; align-items: center; justify-content: center;">‚öôÔ∏è</button>

  <!-- Visualizer Controls Modal -->
  <div id="visualizer-controls-modal" class="modal hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center">
    <div id="visualizer-controls" class="relative w-full max-w-3xl mx-4 bg-gray-900 border border-gray-700 rounded-lg p-4 shadow-lg" style="min-width: 340px; max-height: 90vh; overflow-y: auto;">
      <!-- VisualizerControls will render here -->
    </div>
  </div>
  <!-- Add a button to open the modal -->
  <button id="openVisualizerControls" style="position: absolute; bottom: 90px; right: 24px; z-index: 100; background: #2196F3; color: #fff; border: none; border-radius: 50%; width: 48px; height: 48px; font-size: 1.7rem; box-shadow: 0 2px 8px rgba(0,0,0,0.2); cursor: pointer; display: flex; align-items: center; justify-content: center;">üé®</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <script type="module" src="./main.ts"></script>
</body>
</html>